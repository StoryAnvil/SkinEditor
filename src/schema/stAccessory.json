{
    "$schema": "https://json-schema.org/draft-07/schema#",
    "$id": "storyAnvilAccessory",
    "$anchor": "StoryAnvil",
    "type": "object",
    "properties": {
        "meta": {
            "description": "Metadata for this accessory. This settings do not affect how accessory is rendered",
            "type": "object",
            "properties": {
                "name": {
                    "description": "Display name for this accessory",
                    "type": "string"
                },
                "author": {
                    "description": "Author of authors of this accessory",
                    "type": "string"
                },
                "category": {
                    "description": "Category of this accessory",
                    "type": "string",
                    "enum": [
                        "hat",
                        "face",
                        "hair",
                        "body",
                        "arms",
                        "legs",
                        "feet"
                    ]
                },
                "tags": {
                    "description": "Any tags for this accessory. For example \"christmas\" for christmas-themed accessories",
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "uniqueItems": true,
                    "maxItems": 10
                }
            },
            "required": ["name", "author", "category", "tags"]
        },
        "inputs": {
            "description": "Inputs this accessory takes to customize its apearance.",
            "type": "object",
            "additionalProperties": {
                "oneOf": [
                    {
                        "description": "Color input",
                        "type": "object",
                        "properties": {
                            "type": {
                                "description": "Type of this input",
                                "type": "string",
                                "enum": ["color"]
                            },
                            "name": {
                                "description": "Display name for this input",
                                "type": "string"
                            },
                            "default": {
                                "description": "Hex code of color to use as default value for this input. Alpha channel is not currently supported",
                                "type": "string",
                                "pattern": "^[0-9ABCDEF]{6}$"
                            },
                            "alpha": {
                                "description": "Alpha value",
                                "$ref": "#/definitions/value",
                                "default": 255
                            }
                        },
                        "required": ["type", "name", "default"]
                    },
                    {
                        "description": "Contant input",
                        "type": "object",
                        "properties": {
                            "type": {
                                "description": "Type of this input",
                                "type": "string",
                                "enum": ["constant", "const"]
                            },
                            "value": {
                                "$ref": "#/definitions/value"
                            }
                        },
                        "required": ["type", "value"]
                    },
                    {
                        "description": "Slim or classic input. Returns true if current skin is slim",
                        "type": "object",
                        "properties": {
                            "type": {
                                "description": "Type of this input",
                                "type": "string",
                                "enum": ["isSlim"]
                            }
                        },
                        "required": ["type"]
                    },
                    {
                        "description": "Input that returns true",
                        "type": "object",
                        "properties": {
                            "type": {
                                "description": "Type of this input",
                                "type": "string",
                                "enum": ["always"]
                            }
                        },
                        "required": ["type"]
                    },
                    {
                        "description": "Integer range input",
                        "type": "object",
                        "properties": {
                            "type": {
                                "description": "Type of this input",
                                "type": "string",
                                "enum": ["intrange"]
                            },
                            "name": {
                                "description": "Display name for this input",
                                "type": "string"
                            },
                            "default": {
                                "description": "Default value for this input. If not specified minimum value is used",
                                "type": "integer"
                            },
                            "minimum": {
                                "description": "Minimum value for this input",
                                "type": "integer"
                            },
                            "maximum": {
                                "description": "Maximum value for this input",
                                "type": "integer"
                            }
                        },
                        "required": ["type", "name", "minimum", "maximum"]
                    }
                ]
            }
        },
        "actions": {
            "description": "List of actions to apply",
            "$ref": "#/definitions/actions"
        },
        "layers": {
            "description": "Layers to compose accessory's texture from",
            "type": "object",
            "additionalProperties": {
                "description": "Single accessory layer",
                "type": "object",
                "properties": {
                    "buffer": {
                        "description": "ID of existing pixel buffer to use for this layer. Pixel buffer must be declared in accessory's buffers object",
                        "type": "string"
                    },
                    "offset": {
                        "description": "Coordinate offset for this layer (in pixels)",
                        "type": "array",
                        "items": [
                            {
                                "description": "X offset",
                                "type": "integer",
                                "minimum": 0,
                                "maximum": 64
                            },
                            {
                                "description": "Y offset",
                                "type": "integer",
                                "minimum": 0,
                                "maximum": 64
                            }
                        ],
                        "additionalItems": false,
                        "minItems": 2,
                        "default": [0, 0]
                    },
                    "enabledByDefault": {
                        "description": "True of this layer should be enabled by default",
                        "type": "boolean",
                        "default": false
                    }
                },
                "required": ["buffer"]
            }
        },
        "buffers": {
            "description": "Pixel buffers used to draw layers",
            "type": "object",
            "additionalProperties": {
                "description": "Single pixel buffer",
                "type": "object",
                "properties": {
                    "px": {
                        "description": "Pixel data for this buffer",
                        "type": "object",
                        "patternProperties": {
                            "^[0-9ABCDEF]{6}|[0-9ABCDEF]{8}$": {
                                "$ref": "#/definitions/pixelPosArray"
                            },
                            "^#": {
                                "description": "Use color from input with ID specified after #",
                                "$ref": "#/definitions/pixelPosArray"
                            }
                        },
                        "additionalProperties": false
                    }
                },
                "required": ["px"]
            },
            "minProperties": 1
        }
    },
    "required": ["meta", "layers", "buffers"],
    "definitions": {
        "pixelPosArray": {
            "description": "Pixels of single color",
            "type": "array",
            "items": {
                "description": "Sum of Y-coordinate multiplied by 100 and X-coordinate",
                "minimum": 0
            },
            "minItems": 1
        },
        "actions": {
            "description": "List of actions this input causes",
            "type": "array",
            "items": [
                {
                    "oneOf": [
                        {
                            "description": "Enable/Disable layers",
                            "type": "object",
                            "properties": {
                                "type": {
                                    "description": "Type of this action",
                                    "type": "string",
                                    "enum": ["setlayer"]
                                },
                                "enable": {
                                    "description": "List of layers to enable",
                                    "type": "array",
                                    "items": {
                                        "description": "Name of layer to enable",
                                        "type": "string"
                                    },
                                    "default": []
                                },
                                "disable": {
                                    "description": "List of layers to disable",
                                    "type": "array",
                                    "items": {
                                        "description": "Name of layer to disable",
                                        "type": "string"
                                    },
                                    "default": []
                                }
                            },
                            "required": ["type"]
                        },
                        {
                            "description": "Set layers offset",
                            "type": "object",
                            "properties": {
                                "type": {
                                    "description": "Type of this action",
                                    "type": "string",
                                    "enum": ["addoffset"]
                                },
                                "layers": {
                                    "description": "ID of layers to add offset for",
                                    "type": "array",
                                    "items": {
                                        "description": "Single layer ID",
                                        "type": "string"
                                    }
                                },
                                "x_offset": {
                                    "description": "X Offset value",
                                    "$ref": "#/definitions/value"
                                },
                                "y_offset": {
                                    "description": "Y Offset value",
                                    "$ref": "#/definitions/value"
                                }
                            },
                            "required": ["type", "layers"]
                        },
                        {
                            "description": "Set layers tint",
                            "type": "object",
                            "properties": {
                                "type": {
                                    "description": "Type of this action",
                                    "type": "string",
                                    "enum": ["settint"]
                                },
                                "layers": {
                                    "description": "ID of layers to set tint for",
                                    "type": "array",
                                    "items": {
                                        "description": "Single layer ID",
                                        "type": "string"
                                    }
                                },
                                "tint": {
                                    "description": "Tint color (HEX)",
                                    "$ref": "#/definitions/value"
                                }
                            },
                            "required": ["type", "layers"]
                        },
                        {
                            "description": "Execute if",
                            "type": "object",
                            "properties": {
                                "type": {
                                    "description": "Type of this action",
                                    "type": "string",
                                    "enum": ["if"]
                                },
                                "condition": {
                                    "description": "Condition for this if",
                                    "type": "array",
                                    "items": [
                                        {
                                            "$ref": "#/definitions/value"
                                        },
                                        {
                                            "description": "Operator for values",
                                            "type": "string",
                                            "enum": [
                                                "==",
                                                "!=",
                                                ">",
                                                "<",
                                                ">=",
                                                "<="
                                            ]
                                        },
                                        {
                                            "$ref": "#/definitions/value"
                                        }
                                    ]
                                },
                                "actions": {
                                    "description": "Actions to execute if condition resulted in positive value",
                                    "$ref": "#/definitions/actions"
                                }
                            },
                            "required": ["type", "condition", "actions"]
                        },
                        {
                            "description": "Execute if boolean value",
                            "type": "object",
                            "properties": {
                                "type": {
                                    "description": "Type of this action",
                                    "type": "string",
                                    "enum": ["ifBool"]
                                },
                                "condition": {
                                    "$ref": "#/definitions/value"
                                },
                                "if": {
                                    "description": "Actions to execute if condition is true",
                                    "$ref": "#/definitions/actions"
                                },
                                "else": {
                                    "description": "Actions to execute if condition is false",
                                    "$ref": "#/definitions/actions"
                                }
                            },
                            "required": ["type", "condition"]
                        }
                    ]
                }
            ]
        },
        "value": {
            "oneOf": [
                {"description": "Literal Value", "type": "boolean"},
                {"description": "Literal Value", "type": "number"},
                {"description": "Literal Value", "type": "string"},
                {
                    "description": "Expression Value (get input value)",
                    "type": "object",
                    "properties": {
                        "type": {
                            "description": "Expression type",
                            "enum": ["input"]
                        },
                        "input": {
                            "description": "ID of input to take value from",
                            "type": "string"
                        }
                    },
                    "required": ["type", "input"]
                }
            ]
        }
    }
}
